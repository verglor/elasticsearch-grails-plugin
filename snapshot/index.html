<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Puneet Behl">
<meta name="copyright" content="Apache License, Version 2.0">
<title>Elasticsearch Plugin - Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Elasticsearch Plugin - Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Puneet Behl</span><br>
<span id="revnumber">version 2.5.0.BUILD-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#features">1.1. Features</a></li>
<li><a href="#history">1.2. History</a></li>
<li><a href="#acknowledgments">1.3. Acknowledgments</a></li>
<li><a href="#plugin-versioning">1.4. Plugin Versioning</a></li>
<li><a href="#license">1.5. License</a></li>
</ul>
</li>
<li><a href="#configuration">2. Configuration</a>
<ul class="sectlevel2">
<li><a href="#overriding-spring-boot-elasticsearch-version">2.1. Overriding Spring Boot elasticsearch version</a></li>
<li><a href="#default-configuration-script">2.2. Default configuration script</a></li>
<li><a href="#client-mode">2.3. Client mode</a></li>
<li><a href="#mapping-migration-properties">2.4. Mapping Migration properties</a></li>
<li><a href="#dynamic-method-injection">2.5. Dynamic Method Injection</a></li>
<li><a href="#others-properties">2.6. Others properties</a></li>
</ul>
</li>
<li><a href="#quickStart">3. Quick Start</a>
<ul class="sectlevel3">
<li><a href="#default-mapping">3.1. Default mapping</a></li>
<li><a href="#custom-mapping">3.2. Custom mapping</a></li>
<li><a href="#limit-properties-with-only-except">3.3. Limit properties with only/except</a></li>
<li><a href="#including-transients">3.4. Including transients</a></li>
<li><a href="#transients-and-collections">3.5. Transients and collections</a></li>
<li><a href="#the-mapper-attachment-plugin">3.6. The Mapper Attachment plugin</a></li>
</ul>
</li>
<li><a href="#mapping">4. Mapping</a>
<ul class="sectlevel2">
<li><a href="#class-mapping">4.1. Class Mapping</a></li>
<li><a href="#properties-mapping">4.2. Properties Mapping</a></li>
<li><a href="#parentChild">4.3. Parent Child</a></li>
<li><a href="#geoPoint">4.4. Geo Point</a></li>
<li><a href="#alias">4.5. Alias</a></li>
<li><a href="#dynamic">4.6. Dynamic</a></li>
<li><a href="#searchableComponentReference">4.7. Searchable Component Reference</a></li>
<li><a href="#mappingMigrations">4.8. Mapping Migrations</a></li>
</ul>
</li>
<li><a href="#indexing">5. Indexing</a>
<ul class="sectlevel2">
<li><a href="#index-examples">5.1. Index examples</a></li>
<li><a href="#unindex-examples">5.2. Unindex examples</a></li>
</ul>
</li>
<li><a href="#searching">6. Searching</a>
<ul class="sectlevel2">
<li><a href="#queryStrings">6.1. Query Strings</a></li>
<li><a href="#queryClosure">6.2. Query Closure</a></li>
<li><a href="#queryBuilder">6.3. Query Builder</a></li>
<li><a href="#filterClosure">6.4. Filter Closure</a></li>
<li><a href="#filterBuilder">6.5. Filter Builder</a></li>
<li><a href="#highlighting">6.6. Highlighting</a></li>
<li><a href="#sorting">6.7. Sorting</a></li>
<li><a href="#pagination">6.8. Pagination</a></li>
</ul>
</li>
<li><a href="#admin">7. Admin</a>
<ul class="sectlevel2">
<li><a href="#refresh">7.1. Refresh</a></li>
<li><a href="#deleteIndex">7.2. Delete Index</a></li>
</ul>
</li>
<li><a href="#lowLevelAPI">8. Low Level API</a></li>
<li><a href="#example">9. Example</a>
<ul class="sectlevel2">
<li><a href="#twitter">9.1. Twitter</a></li>
<li><a href="#geoDistanceSearch">9.2. Geo Distance Search</a></li>
<li><a href="#parentChildExample">9.3. Parent/Child mapping</a></li>
</ul>
</li>
<li><a href="#faq">10. Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="#conflictingModules">10.1. Conflicting module versions</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ElasticSearch plugin intends to implement a simple integration with Grails of the Open Source Search Engine <a href="http://www.elasticsearch.org/">ElasticSearch</a>,
which is based on Lucene and provide distributed capabilities.</p>
</div>
<div class="paragraph">
<p>The plugin focus on exposing Grails domain classes for the moment. It highly takes the existing <a href="http://grails.org/plugin/searchable">Searchable Plugin</a> as
reference for its syntax and behaviour.</p>
</div>
<div class="paragraph">
<p>Note that the plugin is still under development, so you may not be able to use all the features of ElasticSearch yet.</p>
</div>
<div class="paragraph">
<p>In addition to this document, you may want to read the official ElasticSearch documentation <a href="http://www.elasticsearch.org/guide/">here</a>.</p>
</div>
<div class="sect2">
<h3 id="features">1.1. Features</h3>
<div class="ulist">
<ul>
<li>
<p>Maps domain classes to their corresponding index in ElasticSearch</p>
</li>
<li>
<p>Provides an ElasticSearch service for cross-domain searching</p>
</li>
<li>
<p>Injects domain class methods for specific domain searching, indexing and unindexing</p>
</li>
<li>
<p>Automatically mirrors any changes made through GORM to the index</p>
</li>
<li>
<p>Allow to use the Groovy Content Builder DSL for search queries</p>
</li>
<li>
<p>Support for term highlighting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="history">1.2. History</h3>
<div class="sect3">
<h4 id="grails-3-x-version">1.2.1. Grails 3.x version</h4>
<div class="ulist">
<ul>
<li>
<p>May 10, 2018</p>
<div class="ulist">
<ul>
<li>
<p>2.4.1</p>
<div class="ulist">
<ul>
<li>
<p><code>search</code> method now returns <code>ElasticsearchResult</code> instead of <code>Map</code>.</p>
</li>
<li>
<p>Added configuration <code>elasticSearch.plugin.mapperAttachment.enabled</code> to disable Mapper Attachment plugin.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>December 12, 2017</p>
<div class="ulist">
<ul>
<li>
<p>2.4.0.RC1</p>
<div class="ulist">
<ul>
<li>
<p>Support Grails 3.3.x</p>
</li>
<li>
<p>The mapper-attachments plugin has been changed to <code>provided</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>August 17, 2017</p>
<div class="ulist">
<ul>
<li>
<p>1.4.1</p>
<div class="ulist">
<ul>
<li>
<p>Upgraded to Elasticsearch 5.4.1</p>
<div class="ulist">
<ul>
<li>
<p>Changed data types 'string' to 'text' and 'keyword' with sensible defaults</p>
</li>
<li>
<p>BREAKING CHANGE: if you want to sort or aggregate by text properties your need to add fielddata: true since it is disabled by default in ES 5.x</p>
</li>
<li>
<p>BREAKING CHANGE: default search type changed to QUERY_THEN_FETCH. See the tip at the end of <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/relevance-is-broken.html">here</a></p>
</li>
<li>
<p>Added initial support for <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html">fields</a></p>
</li>
<li>
<p>Ignore _all configuration for component objects</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>June 3, 2016</p>
<div class="ulist">
<ul>
<li>
<p>1.2.0</p>
<div class="ulist">
<ul>
<li>
<p>Upgraded to Elasticsearch 2.3.3</p>
<div class="ulist">
<ul>
<li>
<p>Support for <code>elasticsearch-groovy</code> client removed (no available compatible version, pending on <a href="https://github.com/elastic/elasticsearch-groovy/issues/35">Issue 35</a>)</p>
</li>
<li>
<p><code>delete</code> migration strategy has been replaced by <code>deleteIndex</code>, due to new Elasticsearch 2.x API&#8217;s</p>
</li>
</ul>
</div>
</li>
<li>
<p>Removed test classes from plugin distribution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>April 18, 2016</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0.1</p>
<div class="ulist">
<ul>
<li>
<p>Add ability to change search method name in domain class via config</p>
</li>
<li>
<p>Updated documentation to asciidoc</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>February 29, 2016</p>
<div class="ulist">
<ul>
<li>
<p>1.0.0</p>
<div class="ulist">
<ul>
<li>
<p>Support for Grails 3.1.1</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="grails-2-x-version">1.2.2. Grails 2.x version</h4>
<div class="ulist">
<ul>
<li>
<p>April 3, 2016</p>
<div class="ulist">
<ul>
<li>
<p>0.1.0</p>
<div class="ulist">
<ul>
<li>
<p>New Elasticsearch 2.1.2 release</p>
</li>
<li>
<p>Immutable Settings Removed  - Use <code>Settings.builder()</code> instead of <code>ImmutableSettings.builder()</code></p>
</li>
<li>
<p><code>BroadcastOperationResponse</code> got renamed to <code>BroadcastResponse</code></p>
</li>
<li>
<p>Removed <code>deleteMapping</code></p>
</li>
<li>
<p><code>memory</code> type is now deprecated</p>
</li>
<li>
<p>Query/filter refactoring - <code>org.elasticsearch.index.queries.FilterBuilders</code> has been removed as part of the merge of queries and filters. These filters are now available in <code>QueryBuilders</code> with the same name. All methods that used to accept a <code>FilterBuilder</code> now accept a <code>QueryBuilder</code> instead.</p>
</li>
<li>
<p>For more information related to changes in underline Java API <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_20_java_api_changes.html#_query_filter_refactoring">click here</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>June 30, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.5</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to ElasticSearch 1.6.0</p>
</li>
<li>
<p>Support the return of aggregation results</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>June 15, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.5</p>
<div class="ulist">
<ul>
<li>
<p>Add the ability to define property names that are excluded by default</p>
</li>
<li>
<p>Fix NPE</p>
</li>
<li>
<p>Add the attachment type</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>March 5, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.4</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Elasticsearch-Groovy 1.4.4</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>February 22, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.3</p>
<div class="ulist">
<ul>
<li>
<p>Add mapping configuration support for '_all'</p>
</li>
<li>
<p>Fix issue with indexing nested GeoPoint</p>
</li>
<li>
<p>Add support for transient properties</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>February 10, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.2</p>
<div class="ulist">
<ul>
<li>
<p>Reduce severity of non-searchable property in index document when unmarshalling domain</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>February 03, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.1</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Elasticsearch 1.4.2</p>
</li>
<li>
<p>Enable configuration of the number of replicas created per shard</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>January 28, 2015</p>
<div class="ulist">
<ul>
<li>
<p>0.0.4.0</p>
<div class="ulist">
<ul>
<li>
<p>Included Mapping migrations</p>
</li>
<li>
<p>Included read and write aliases to indices to deal with migrations on multinode deployments</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>December 14, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.8</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to ElasticSearch 1.4.1</p>
</li>
<li>
<p>Support the min_score query parameter.</p>
</li>
<li>
<p>Try to detect the MongoDB without using the plugin manager.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>December 01, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.7</p>
<div class="ulist">
<ul>
<li>
<p>Create separate SimpleTypeConverter per-thread</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>November 06, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.6</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to ElasticSearch 1.4.0</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>October 28, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.5</p>
<div class="ulist">
<ul>
<li>
<p>Fix the bulk index query iteration.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>October 14, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.4</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to latest version of ElasticSearch and remove the Groovy client dependency.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>August 28, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.3</p>
<div class="ulist">
<ul>
<li>
<p>Configure a component field to act as an inner object instead of a nested object.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>August 3, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.2</p>
<div class="ulist">
<ul>
<li>
<p>Add the ability to mark fields with aliases</p>
</li>
<li>
<p>Support ES client HTTP configuration parameters</p>
</li>
<li>
<p>Improve Hibernate 4 support</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>June 9, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.1</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to ElasticSearch 1.2.x</p>
</li>
<li>
<p>Add special treatment for MongoDB ObjectId data types</p>
</li>
<li>
<p>Return raw result objects when now class mapping is found</p>
</li>
<li>
<p>Fix integration-test NPE</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>May 25, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.3.0</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Grails dependency 2.2.x</p>
</li>
<li>
<p>Upgrade to Grails runtime 2.3.x</p>
</li>
<li>
<p>Upgrade to ElasticSearch 1.x</p>
</li>
<li>
<p>Apply ElasticSearch 1.x compatibility fixes</p>
</li>
<li>
<p>Enable customization of index name types when mapping classes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>May 15, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.6</p>
<div class="ulist">
<ul>
<li>
<p>Use 'grails.util.Holders' instead of ApplicationHolder</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>April 2, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.5</p>
<div class="ulist">
<ul>
<li>
<p>Start releasing the plugin as 'elasticsearch' instead of 'elasticsearch-gorm'</p>
</li>
<li>
<p>Fix NPE when marshalling JSONObject fields</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>March 24, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.4</p>
<div class="ulist">
<ul>
<li>
<p>GeoPoint mapping</p>
</li>
<li>
<p>Injected service now supports filters (e.g. geo_reference) and sort builders (e.g. for geo_distance sorting)</p>
</li>
<li>
<p>Marshalled date values are now with correct time zone</p>
</li>
<li>
<p>Removed dependency on Java 7</p>
</li>
<li>
<p>Fix support of BigDecimal</p>
</li>
<li>
<p>Searchable mapping property name and Elasticsearch plugin path are now configurable.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>February 4, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.3 Bugfix release</p>
</li>
</ul>
</div>
</li>
<li>
<p>January 19, 2014</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.2 Bugfix release</p>
</li>
</ul>
</div>
</li>
<li>
<p>November 24, 2013</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2.1 Bugfix release</p>
</li>
</ul>
</div>
</li>
<li>
<p>November 12, 2013</p>
<div class="ulist">
<ul>
<li>
<p>0.0.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>November 2, 2013</p>
<div class="ulist">
<ul>
<li>
<p>initial 0.0.1 release</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgments">1.3. Acknowledgments</h3>
<div class="paragraph">
<p>Many thanks to all the users who reported issues and sent me pull requests.</p>
</div>
<div class="sect3">
<h4 id="authors-and-contributors">1.3.1. Authors and Contributors</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/noamt">Noam Y. Tenne</a></p>
</li>
<li>
<p><a href="https://github.com/stefanrother">Stefan Rother-St√ºbs (Dating Cafe)</a></p>
</li>
<li>
<p><a href="https://github.com/skies">Sven Kiesewetter (Dating Cafe)</a></p>
</li>
<li>
<p>Michael Schwartz (Dating Cafe)</p>
</li>
<li>
<p><a href="https://github.com/marcoscarceles">Marcos Carceles</a></p>
</li>
<li>
<p><a href="https://github.com/puneetbehl">Puneet Behl</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="authors-and-contributors-of-the-original-plugin">1.3.2. Authors and Contributors of the original plugin</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/mstein">Manuarii Stein (doc4web consulting)</a></p>
</li>
<li>
<p><a href="https://github.com/smaldini">Stephane Maldini (doc4web consulting)</a></p>
</li>
<li>
<p><a href="https://github.com/spn">Serge P. Nekoval</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="previous-work">1.3.3. Previous work</h4>
<div class="paragraph">
<p>Graeme Rocher started the first draft which this plugin is based on.</p>
</div>
<div class="paragraph">
<p>Get the full and updated list of contributors on the <a href="https://github.com/puneetbehl/elasticsearch-grails-plugin/graphs/contributors">github</a> repository.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="plugin-versioning">1.4. Plugin Versioning</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The versioning model has changed. The version number of the plugin will reflect the one of the underline integrated Elasticsearch.
If necessary a 4th level point release number will be used for successive changes on the plugin&#8217;s code with same version of Elasticsearch.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>&lt;GRAILS_VERSION&gt;.&lt;ES_VERSION&gt;.&lt;FEATURE/PATCH_VERSION&gt;</code>, where there isn&#8217;t really a 1-to-1 plugin version to grails or es version, but we just increase our major or minor version by one, whenever there are breaking changes on either Grails or ES.
<code>&lt;GRAILS_VERSION&gt;.&lt;ES_VERSION&gt;.&lt;FEATURE/PATCH_VERSION&gt;</code>, where there isn&#8217;t really a 1-to-1 plugin version to grails or es version, but we just increase our major or minor version by one, whenever there are breaking changes on either Grails or ES. Therefore future release versions could look something similar to this (depending on Grails and Elasticsearch versions):</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Plugin Version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Grails</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Elasticsearch</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.4.0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.3.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.x</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.4.1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.1.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.x (tested with 5.4.1)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.2.0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.1.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.3.x</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.0.0.2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3.0.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.x</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0.1.0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.4.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.1.x</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0.0.4.5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2.4.x</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1.x</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 2.4.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 5.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 2.4.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 5.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 3.2.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 2.3.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 4.0.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(hypothetical) 2.3.x</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Existing versions in</em> <strong>bold</strong></p>
</div>
<div class="paragraph">
<p>Current version is <strong>2.5.0.BUILD-SNAPSHOT</strong> (for Grails 2.x the latest version is <strong>0.1.0</strong>)</p>
</div>
</div>
<div class="sect2">
<h3 id="license">1.5. License</h3>
<div class="paragraph">
<p>This plugin is released under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration">2. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin provide a default configuration, but you may add your own settings in your <strong>Config.groovy</strong> for Grails 2.x and <strong>application.groovy</strong> or <strong>application.yml</strong> for Grails 3.x.</p>
</div>
<div class="sect2">
<h3 id="overriding-spring-boot-elasticsearch-version">2.1. Overriding Spring Boot elasticsearch version</h3>
<div class="paragraph">
<p>Spring Boot 1.3.x supports Elasticsearch 1.5.2 OOTB (<a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-dependencies/pom.xml#L76" class="bare">https://github.com/spring-projects/spring-boot/blob/master/spring-boot-dependencies/pom.xml#L76</a>) and will install dependencies for this version, if not explicitly overriden. To do so add the following to your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def elasticsearchVersion = '5.4.3'
ext['elasticsearch.version'] = elasticsearchVersion</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-configuration-script">2.2. Default configuration script</h3>
<div class="paragraph">
<p>Below is the default configuration loaded by the plugin (any of your settings in the Config.groovy script overwrite those).</p>
</div>
<div class="listingblock">
<div class="title">Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">elasticSearch {
  /**
   * Date formats used by the unmarshaller of the JSON responses
   */
  date.formats = ["yyyy-MM-dd'T'HH:mm:ss'Z'"]

  /**
   * Hosts for remote ElasticSearch instances.
   * Will only be used with the "transport" client mode.
   * If the client mode is set to "transport" and no hosts are defined, ["localhost", 9300] will be used by default.
   */
  client.hosts = [
          [host:'localhost', port:9300]
  ]

  /**
   * Default mapping property exclusions
   *
   * No properties matching the given names will be mapped by default
   * i.e., when using "searchable = true"
   *
   * This does not apply for classes using mapping by closure
   */
  defaultExcludedProperties = ["password"]

  /**
   * Determines if the plugin should reflect any database save/update/delete automatically
   * on the ES instance. Default to false.
   */
  disableAutoIndex = false

  /**
   * Should the database be indexed at startup.
   *
   * The value may be a boolean true|false.
   * Indexing is always asynchronous (compared to Searchable plugin) and executed after BootStrap.groovy.
   */
  bulkIndexOnStartup = true

  /**
   *  Max number of requests to process at once. Reduce this value if you have memory issue when indexing a big amount of data
   *  at once. If this setting is not specified, 500 will be use by default.
   */
  maxBulkRequest = 500


  /**
   * The name of the ElasticSearch mapping configuration property that annotates domain classes. The default is 'searchable'.
   */
  searchableProperty.name = 'searchable'
}

environments {
  development {
    /**
     * Possible values : "local", "dataNode", "transport"
     *
     */
    elasticSearch.client.mode = 'local'
  }
  test {
      elasticSearch {
          client.mode = 'local'
          index.store.type = 'memory' // store local node in memory and not on disk
      }
  }
  production {
    elasticSearch.client.mode = 'transport'
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="grails-3-3-x-sample-yaml-configuration">2.2.1. Grails 3.3.x Sample YAML configuration</h4>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">elasticSearch:
    date:
        formats: ["yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
    client.hosts:
        - {host: localhost, port: 9300}
    defaultExcludedProperties: ['password']
    disableAutoIndex: false
    index:
        compound_format: true
    unmarshallComponents: true
    searchableProperty:
        name: searchable
    includeTransients: false
environments:
    development:
        elasticSearch:
            client:
                mode: local
                transport.sniff: true
            bulkIndexOnStartup: true
    test:
        elasticSearch:
            client:
                mode: local
                transport.sniff: true
            datastoreImpl: hibernateDatastore
            index:
                store.type: memory
                settings:
                    analysis:
                        filter:
                            replace_synonyms:
                                type: synonym
                                synonyms: ['abc =&gt; xyz']
                        analyzer:
                            test_analyzer:
                                tokenizer: standard
                                filter: ['lowercase']
                            repl_analyzer:
                                tokenizer: standard
                                filter: ['lowercase', 'replace_synonyms']

    production:
        elasticSearch:
            client:
                mode: transport</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-mode">2.3. Client mode</h3>
<div class="paragraph">
<p>You can set the plugin in 3 different modes, detailed on the <a href="http://www.elasticsearch.org/guide/en/elasticsearch/client/java-api/current/">official ElasticSearch doc</a>.
The mode is defined with the following config key:</p>
</div>
<div class="listingblock">
<div class="title">applicaiton.groovy or Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">elasticSearch.client.mode = '&lt;mode&gt;'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yml" data-lang="yml">elasticSearch:
	client:
		mode: &lt;mode&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Possible values for client node</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node (Removed in version 2.4.1 of the plugin)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin create its own node and join the ElasticSearch cluster as a client node (<code>node.client = true</code>). This setting requires that you have an ElasticSearch instance running and available on your network (use the discovery feature)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataNode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin create its own node and join the ElasticSearch cluster as a node that can hold data. This setting requires that you have an ElasticSearch instance running and available on your network (use the discovery feature)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin create its own local (to the JVM) node. Does not require any running ElasticSearch instance. Useful for development or testing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin create a transport client that will connect to a remote ElasticSearch instance without joining the cluster.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>"Transport" mode needs you to provide the host address and port. You can define one or multiple hosts with the following config key:</p>
</div>
<div class="listingblock">
<div class="title">application.groovy or Config.groovy</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">elasticSearch.client.hosts = [
       [host:'192.168.0.3', port:9300],
       [host:'228.168.0.4', port:9300]
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">elasticSearch:
	client:
		hosts:
    	- {host: 192.168.0.3, port: 9300}
		- {host: 228.168.0.4, port: 9300}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no host is defined, <code>localhost:9300</code> will be used by the transport client.</p>
</div>
<div class="sect3">
<h4 id="using-node-or-datanode-during-development">2.3.1. Using node or dataNode during development</h4>
<div id="INFO" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The node.client setting has been removed. A node with such a setting set will not start up. Instead, each node role needs to be set separately using the existing node.master, node.data and node.ingest supported static settings.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If you configure your dev environment to use <code>node</code> or <code>dataNode</code> you might see the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">'elasticSearchClient': FactoryBean threw exception on object creation; nested exception is java.lang.IllegalStateException: path.home is not configured</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make this work you need to define <code>es.path.home</code> in VM options.</p>
</div>
<div class="listingblock">
<div class="title">Grails 2.x</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">grails run-app -Des.path.home=&lt;PATH_TO_ELASTICSEARCH_HOME_DIR&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Grails 3.x (build.gradle)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">bootRun {
    jvmArgs = ['-Des.path.home=&lt;PATH_TO_ELASTICSEARCH_HOME_DIR&gt;']
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="disable-mapper-attachment-plugin">2.3.2. Disable Mapper Attachment plugin</h4>
<div class="paragraph">
<p>The Mapper Attachment plugin is Deprecated since version 5.0.0 and will be replaced by <a href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.0/ingest-attachment.html">ingest-attachment</a> plugin.</p>
</div>
<div class="paragraph">
<p>So, if you are using ES plugin with mode: <code>local</code> and do not want to use Mapper Attachment plugin then you can disable the plugin by using following configuration:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">elasticSearch:
    plugin:
        mapperAttachment:
            enabled: false</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that by default the plugin is enabled.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapping-migration-properties">2.4. Mapping Migration properties</h3>
<div class="paragraph">
<p>Define the application&#8217;s behaviour when a conflict is found while installing Elasticsearch mappings on startup. For a detailed explanation, see <a href="#mappingMigrations">Mapping Migrations</a>.</p>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-migration-strategy-code">2.4.1. <code>elasticSearch.migration.strategy</code></h4>
<div class="paragraph">
<p>Defines the behaviour to follow if an error occurs on startup when the application is installing new mappings on ElasticSearch due to conflicting mappings.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Possible Values for migration strategy</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'none'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No changes on the indices or mappings will happen, the merge problem will be logged and a MappingException will be thrown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'delete'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The conflicting mapping will be deleted (along with all indexed content of that type) and replaced with a new mapping. Deleted content can be automatically reindexed on startup by using this in combination the <code>elasticSearch.bulkIndexOnStartup</code> config option</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'alias'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applies <a href="http://www.elasticsearch.org/blog/changing-mapping-with-zero-downtime/">Elasticsearch recommended approach for migrating conflicting mappings</a>. A new numbered index will be created (<code>&lt;indexName&gt;_vX</code>) where new mappings will installed for all the types included on the original index. An Elasticsearch alias called <code>&lt;indexName&gt;</code> will point to the new index. As content won&#8217;t be available on the new index, content can be automatically reindexed on startup by using this in combination the <code>elasticSearch.bulkIndexOnStartup</code> config option. It is recommended to set <code>elasticSearch.aliasReplacesIndex</code> to deal with potential index/alias conflicts.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default is <code>'alias'</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-migration-aliasreplacesindex-code">2.4.2. <code>elasticSearch.migration.aliasReplacesIndex</code></h4>
<div class="paragraph">
<p>Deals with a special conflict case using the <code>'alias'</code> strategy. When the <code>'alias'</code> migration strategy is chosen and there&#8217;s a mapping conflict on an index, defines whether to replace the index with a versioned index (<code>&lt;indexName&gt;_vX</code>) and an alias (<code>&lt;indexName&gt;</code>). This is required when applying the alias strategy on top of existing indices for the first time as indices cannot be renamed (from <code>&lt;indexName&gt;</code> to <code>&lt;indexName&gt;_vX</code>) and an alias cannot exist with the same name as an index.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Possible Values for aliasReplacesIndex</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index and it&#8217;s content will be deleted and a versioned index and an alias will be created. Deleted content can be automatically reindexed on startup by using this in combination the <code>elasticSearch.bulkIndexOnStartup</code> config option</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Falls back to the <code>'none'</code> strategy. Event will be logged and a MappingException will be thrown.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default is <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-migration-disablealiaschange-code">2.4.3. <code>elasticSearch.migration.disableAliasChange</code></h4>
<div class="paragraph">
<p>In some cases the developer may prefer not to upgrade the alias to the new version of the index until some other tasks are performed. This allows them to disable automatically pointing the alias to a new version of the index when this is created. Aliases can be changed later on manually or programatically using <code>elasticSearchAdminService</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Possible Values for disableAliasChange</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard behaviour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prevents the aliases to be changed to point to a new index</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default is <code>false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-method-injection">2.5. Dynamic Method Injection</h3>
<div class="sect3">
<h4 id="code-elasticsearch-searchmethodname-code">2.5.1. <code>elasticSearch.searchMethodName</code></h4>
<div class="paragraph">
<p>Change the name of search method in domain class. By default it&#8217;s <code>search</code>.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">MyDomain.search("${params.query}")</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to change the method name to <code>esSearch</code> just update the <code>elasticSearch.searchMethodName='esSearch'</code> in application.groovy</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-counthitsmethodname-code">2.5.2. <code>elasticSearch.countHitsMethodName</code></h4>
<div class="paragraph">
<p>Change the name of countHits method in domain class. By default it&#8217;s <code>countHits</code>.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">MyDomain.countHits("${params.query}")</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to change the method name to <code>esCountHits</code> just update the <code>elasticSearch.countHitsMethodName='esCountHits'</code> in application.groovy</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-disabledynamicmethodsinjection-code">2.5.3. <code>elasticSearch.disableDynamicMethodsInjection</code></h4>
<div class="paragraph">
<p>To complete disabled injection of dynamic methods set <code>elasticSearch.disableDynamicMethodsInjection = true</code> in <code>applicaiton.groovy</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="others-properties">2.6. Others properties</h3>
<div class="sect3">
<h4 id="code-elasticsearch-datastoreimpl-code">2.6.1. <code>elasticSearch.datastoreImpl</code></h4>
<div class="paragraph">
<p>Only required when enabling the auto-index feature.
This property specifies which GORM datastore implementation should be watched for storage events.
The value should be the name of the datastore bean as it is configured in the Spring context; some possible values:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Possible Values for datastoreImpl</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongoDatastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the MongoDB datastore bean.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hibernateDatastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the Hibernate datastore bean.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-bootstrap-config-file-code">2.6.2. <code>elasticSearch.bootstrap.config.file</code></h4>
<div class="paragraph">
<p>When using then plugin to construct a local node, the default Elasticsearch configuration is used by default.
If you use a modified Elasticsearch configuration, you can use this property to specify the location of the file (as an application resource).</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-bootstrap-transportsettings-file-code">2.6.3. <code>elasticSearch.bootstrap.transportSettings.file</code></h4>
<div class="paragraph">
<p>When choosing transport mode this configuration will be used to set up the TransportClient settings (used by some cloud providers).</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-client-transport-sniff-code">2.6.4. <code>elasticSearch.client.transport.sniff</code></h4>
<div class="paragraph">
<p>Only usable in with a transport client.
Allows to sniff the rest of the cluster, and add those into its list of machines to use.
In this case, the ip addresses used will be the ones that the other nodes were started with (the ‚Äúpublish‚Äù address)</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-cluster-name-code">2.6.5. <code>elasticSearch.cluster.name</code></h4>
<div class="paragraph">
<p>The name of the cluster for the client to join.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-date-formats-code">2.6.6. <code>elasticSearch.date.formats</code></h4>
<div class="paragraph">
<p>List of date formats used by the JSON unmarshaller to parse any date field properly.
Note : future version of the plugin may change how formats are manipulated.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-defaultexcludedproperties-code">2.6.7. <code>elasticSearch.defaultExcludedProperties</code></h4>
<div class="paragraph">
<p>List of domain class properties to automatically ignore (will not be indexed) if their name match one of those.
This will apply to both the default-mapped domain class, with the static <code>searchable</code> property set to "true", and when using closure mapping.
To override this setting on a specific class, it can be added to the <code>only</code> property of the <code>searchable</code> closure.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-disableautoindex-code">2.6.8. <code>elasticSearch.disableAutoIndex</code></h4>
<div class="paragraph">
<p>A boolean determining if the plugin should reflect any database save/update/delete automatically on the indices.
Default to <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-bulkindexonstartup-code">2.6.9. <code>elasticSearch.bulkIndexOnStartup</code></h4>
<div class="paragraph">
<p>Determines whether the application should launch a bulk index operation upon startup.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Possible Values for bulkIndexOnStartup</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No indexing will happen on startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All content will be indexed on startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'deleted'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value is related to the mapping migration strategy chosen. If any migration is required and any content is deleted due to it, on startup only indices and mappings lost will be indexed. More on <a href="#mappingMigrations">Mapping Migrations</a>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Default to <code>true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-index-name-code">2.6.10. <code>elasticSearch.index.name</code></h4>
<div class="paragraph">
<p>A string indicating which ElasticSearch index should be used.  If not present, will default to the package name of the domain in question.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From Elasticsearch 5.0 on only selected settings like for instance index.codec can be set on the node level. All other settings must be set on each individual index. To set default values on every index, index templates should be used instead. So, unset this value if you are using Elasticsearch v5.0 or above.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-index-compound_format-code">2.6.11. <code>elasticSearch.index.compound_format</code></h4>
<div class="paragraph">
<p>Should the compound file format be used (boolean setting).
Set to <code>false</code> by default (really applicable for file system based index storage).
More details on this setting on the <a href="http://www.elasticsearch.org/guide/reference/index-modules/">ElasticSearch Documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-index-store-type-code">2.6.12. <code>elasticSearch.index.store.type</code></h4>
<div class="paragraph">
<p>Determine how the indices will be stored.
More details on the possible values on the <a href="http://www.elasticsearch.org/guide/reference/index-modules/store.html">ElasticSearch Documentation</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Possible value for index store type</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the index in memory. Useful for testing. <strong>Please note</strong> that it&#8217;s not support in ES 2.0 and later versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mmapfs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the shard index on the file system (maps to Lucene MMapDirectory) using mmap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">niofs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the shard index on the file system (maps to Lucene NIOFSDirectory) and allows for multiple threads to read from the same file concurrently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simplefs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores using a plain forward implementation of file system storage (maps to Lucene SimpleFsDirectory) using random access file.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-index-settings-numberofreplicas-code">2.6.13. <code>elasticSearch.index.settings.numberOfReplicas</code></h4>
<div class="paragraph">
<p>Sets the number of replicas created for each shard of the index. If not present, will default to zero.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-gateway-type-code">2.6.14. <code>elasticSearch.gateway.type</code></h4>
<div class="paragraph">
<p>Determine the gateway type to be used.
More details on the possible values are in the <a href="http://www.elasticsearch.org/guide/reference/modules/gateway/">ElasticSearch Documentation</a>.
Using a setting of "none" (possibly in combination with index.store.type set to "memory") can be useful for tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-maxbulkrequest-code">2.6.15. <code>elasticSearch.maxBulkRequest</code></h4>
<div class="paragraph">
<p>Max number of requests to process at once.
Reduce this value if you have memory issue when indexing a big amount of data at once.
If this setting is not specified, 500 will be use by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-path-data-code">2.6.16. <code>elasticSearch.path.data</code></h4>
<div class="paragraph">
<p>The location of the data files of each index / shard allocated on the node.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-path-plugins-code">2.6.17. <code>elasticSearch.path.plugins</code></h4>
<div class="paragraph">
<p>The location of plugin files such as native scripts. Each plugin will be contained in a subdirectory.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-searchableproperty-name-code">2.6.18. <code>elasticSearch.searchableProperty.name</code></h4>
<div class="paragraph">
<p>The name of the ElasticSearch mapping configuration property that annotates domain classes. The default is 'searchable'.</p>
</div>
</div>
<div class="sect3">
<h4 id="code-elasticsearch-includetransients-code">2.6.19. <code>elasticSearch.includeTransients</code></h4>
<div class="paragraph">
<p>Whether to index and search all non excluded transient properties. All explicitly included transients in <code>only</code> will be indexed regardless.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Default is <code>false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quickStart">3. Quick Start</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Install Elasticsearch using instructions from <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.4/gs-installation.html">here</a>.</p>
</li>
<li>
<p>Just like any other Grails plugin, through the Grails Plugin center and Edit your project&#8217;s build.gradle file, by adding the plugin&#8217;s dependency declaration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>dependencies {
    ...
    compile "org.grails.plugins:elasticsearch:2.4.0"
    ...
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Overriding Spring Boot elasticsearch version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring Boot 1.3.x supports Elasticsearch 1.5.2 OOTB (<a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-dependencies/pom.xml#L76" class="bare">https://github.com/spring-projects/spring-boot/blob/master/spring-boot-dependencies/pom.xml#L76</a>) and will install dependencies for this version, if not explicitly overriden. To do so add the following to your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def elasticsearchVersion = '5.4.3'
ext['elasticsearch.version'] = elasticsearchVersion</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Updated <code>application.yml</code> with default configurations:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>elasticSearch:
    datastoreImpl: hibernateDatastore
    client:
        mode: transport
        hosts:
          - {host: localhost, port: 9300}
    cluster.name: &lt;ENTER CLUSTER NAME HERE&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In order debug Elasticsearch plugin, add <code>logger("grails.plugins.elasticsearch", DEBUG, ['STDOUT'], false)</code> in <code>logback.groovy</code> file as following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">import grails.util.BuildSettings
import grails.util.Environment
import org.springframework.boot.logging.logback.ColorConverter
import org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter

import java.nio.charset.Charset

conversionRule 'clr', ColorConverter
conversionRule 'wex', WhitespaceThrowableProxyConverter

// See http://logback.qos.ch/manual/groovy.html for details on configuration
appender('STDOUT', ConsoleAppender) {
    encoder(PatternLayoutEncoder) {
        charset = Charset.forName('UTF-8')

        pattern =
                '%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} ' + // Date
                        '%clr(%5p) ' + // Log level
                        '%clr(---){faint} %clr([%15.15t]){faint} ' + // Thread
                        '%clr(%-40.40logger{39}){cyan} %clr(:){faint} ' + // Logger
                        '%m%n%wex' // Message
    }
}

def targetDir = BuildSettings.TARGET_DIR
if (Environment.isDevelopmentMode() &amp;&amp; targetDir != null) {
    appender("FULL_STACKTRACE", FileAppender) {
        file = "${targetDir}/stacktrace.log"
        append = true
        encoder(PatternLayoutEncoder) {
            pattern = "%level %logger - %msg%n"
        }
    }
    logger("StackTrace", ERROR, ['FULL_STACKTRACE'], false)
    logger("grails.plugins.elasticsearch", DEBUG, ['STDOUT'], false)
    root(ERROR, ['STDOUT', 'FULL_STACKTRACE'])
}
else {
    root(ERROR, ['STDOUT'])
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="default-mapping">3.1. Default mapping</h4>
<div class="paragraph">
<p>To declare a domain class to be searchable, the simplest way is to define the following static property in the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">static searchable = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin will generate a default mapping for each properties of the domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-mapping">3.2. Custom mapping</h4>
<div class="paragraph">
<p>You can customize how each properties are mapped to the index using a closure. The syntax is similar to GORM&#8217;s mapping DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">static searchable = {
    // mapping DSL...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See below for more details on the mapping DSL.</p>
</div>
</div>
<div class="sect3">
<h4 id="limit-properties-with-only-except">3.3. Limit properties with only/except</h4>
<div class="paragraph">
<p><code>only</code> and <code>except</code> are used to limit the properties that are made searchable.
You may not define both except &amp; only settings at the same time.</p>
</div>
<div class="paragraph">
<p>The following code will only map the 'message' property, any others will be ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tweet {
    static searchable = {
        only = 'message'
    }
    String message
    String someUselessField
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code will map all properties except the one specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tweet {
    static searchable = {
        except = 'someUselessField'
    }
    String message
    String someUselessField
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a Collection to specify several properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tweet {
    static searchable = {
        except = ['someUselessField', 'userName']
    }
    String message
    String userName
    String someUselessField
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties that are ignored will not be sent to ElasticSearch. It also means that when you will get back a domain
from ElasticSearch, some fields that are not supposed to be null, may still be null.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="including-transients">3.4. Including transients</h4>
<div class="paragraph">
<p>How the plugin manages transient properties is controlled by the <code>elasticSearch.includeTransients</code> configuration property. If this is set to <code>false</code> only transient properties explicitly included in <code>only</code> will be mapped and searchable, if set to <code>true</code>, all domain class properties will be mapped, including <code>transients</code>.</p>
</div>
<div class="paragraph">
<p>The following are valid examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">//assert grailsApplication.config.elasticSearch.includeTransients == false
class Person {
    String firstName
    String lastName
    String getFullName() {
        firstName + " " + lastName
    }
    static transients = ['fullName']
    static searchable = {
        only = ['fullName']
    }
}

// new Person(firstNameme: "Nikola", lastName: "Tesla")
// can be found using:
// def tesla = Person.search("Nikola Tesla").searchResults.first()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">//assert grailsApplication.config.elasticSearch.includeTransients == true
class Multiplication {
    int opA
    int opB
    int getResult() {
        opA * opB
    }
    static transients = ['result']
    static searchable = true
}
// new Multiplication(opA: 2, opB: 3)
// can be found using:
// def multiplication = Multiplication.search("2").searchResults.first()
// def multiplication = Multiplication.search("3").searchResults.first()
// def multiplication = Multiplication.search("6").searchResults.first()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>From the examples above, once the domain object is found, its transient values will be calculated from the information stored on ElasticSearch: <code>multiplication.result == 6</code>, but <code>tesla.fullName == "null null"</code>, as firstName and lastName where not indexed. This behaviour can be prevented by creating convenient setters for the transient properties.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="transients-and-collections">3.5. Transients and collections</h4>
<div class="paragraph">
<p>When transient properties are collections the only way the plugin can define the correct ElasticSearch mapping during boot is if the element types are explicitly defined on the grails domain object. For instances of <code>Collection</code> this can be achieved by defining its type on the <code>hasMany</code> property (otherwise the ElasticSearch type will be defined as <code>object</code>). This is not required for arrays.</p>
</div>
<div class="paragraph">
<p>Some valid examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tweet {
    String message
    List getHashtags() { ... }
    static transients = ['hashtags']
    static hasMany = [hashtags: String]
    static searchable = {only = 'hashtags' }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class FamilyGuy {
    String wife
    String son
    String daughter
    String baby
    String[] getRelatives() { ... }
    static transients = ['relatives']
    static searchable = { only = 'relatives' }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-mapper-attachment-plugin">3.6. The Mapper Attachment plugin</h4>
<div class="paragraph">
<p>The Elasticsearch plugin does not ship with Mapper Attachment plugin, so if you are using mode <code>local</code> and config <code>elasticSearch.plugin.mapperAttachment.enabled: true</code> then you need to add the following dependency in build.gradle</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">compile "org.elasticsearch.plugin:mapper-attachments:2.4.6"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The latest version of Mapper Attachments plugin is not available in Maven</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to use the latest version, you need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download this plugin for offline install from <a href="https://artifacts.elastic.co/downloads/elasticsearch-plugins/mapper-attachments/mapper-attachments-5.6.9.zip" class="bare">https://artifacts.elastic.co/downloads/elasticsearch-plugins/mapper-attachments/mapper-attachments-5.6.9.zip</a> into <code>/libs/elasticsearch</code> folder.</p>
</li>
<li>
<p>Now, include the downloaded lib into project dependencies as:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">compile fileTree(dir: "libs/elasticsearch", include: '*.jar')</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapping">4. Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From version 0.0.4.0 in addition to the indices generated by the plugin based on the domain objects package names or configuration, two new aliases are created for every index: <code>&lt;indexName&gt;_read</code> and <code>&lt;indexName&gt;_write</code>. These two aliases are used by the plugin to index and query from Elasticsearch and are needed to centralise the choice of index to use during mapping migrations when the <code>'alias'</code> strategy is used and there are multiple instances of the application.</p>
</div>
<div class="sect2">
<h3 id="class-mapping">4.1. Class Mapping</h3>
<div class="sect3">
<h4 id="root">4.1.1. root</h4>
<div class="paragraph">
<p>Determine if the domain class will have its own index or not. Take a boolean as parameter, and is set to <code>true</code> by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Preference {
    static searchable = {
        root false
    }
    // ...
}

class Tag {
    static searchable = true
    // ...
}

class Tweet {
    static searchable = {
        message boost:2.0
    }
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, the classes <code>Tweet</code> and <code>Tag</code> are going to have their own index. The class <code>Preference</code> will not.
It also mean that any search request will never return a Preference-type hit. The dynamic method <code>search</code> will not be
injected in the <code>Preference</code> domain class.</p>
</div>
<div class="paragraph">
<p>The domains not root-mapped can still be considered searchable, as they can be components of another domain which is root-mapped.
For example, considered the following domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class User {
    static searchable = {
        userPreferences component:true
    }

    Preference userPreferences
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When searching, any matches in the <code>userPreferences</code> property will be considered as a <code>User</code> match.</p>
</div>
</div>
<div class="sect3">
<h4 id="all">4.1.2. all</h4>
<div class="paragraph">
<p>Set default analyzer for all domain class fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">static searchable = {
  all = [analyzer: 'russian_morphology']
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">static searchable = {
  all = false
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When disabling the all field, it is a good practice to set index.query.default_field to a different value (for example, if you have a main 'message' field in your data, set it to message).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="properties-mapping">4.2. Properties Mapping</h3>
<div class="paragraph">
<p>You can customize the mapping for each domain properties using the closure mapping.
The syntax is simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">static searchable = {
    propertyName option1:value, option2:value, ...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="available-options">4.2.1. Available options</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option Name</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A decimal boost value. With a positive value, promotes search results for hits in this property; with a negative value, demotes search results that hit this property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#searchableComponent">component</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To use only on domain (or collection of domains), make the property a searchable component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">converter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Class</code> to use as a converter during the marshalling/un-marshalling process for that peculiar property. That class must extends the <code>PropertyEditorSupport</code> java class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeFromAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">determines if the property is to append in the <code>"_all"</code> field. Default to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"no"</code>, <code>"not_analyzed"</code>, <code>"analyzed"</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How or if the property is made into searchable element. One of <code>"no"</code>, <code>"not_analyzed"</code> or <code>"analyzed"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fielddata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the use of text fields in sorting and aggregation. Be careful as fielddata can consume a lot of heap space, especially when loading high cardinality text fields. Default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#searchableReference">reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To use only on domain (or collection of domains), make the property a searchable reference.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#parentChild">parent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean value to be used in conjunction with the <code>reference</code> or <code>component</code> property . Set to <code>true</code> if the referenced field should be mapped as the parent of this document. Default set to <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multi_field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean value. Maps the value of the field twice; Once with it being analyzed, and once with it being not_analyzed under the name untouched. Default set to <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map describing the extra fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps the value of the field more than once; it is useful when you want to index a field with different analyzers. See the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html">ElasticSearch documentation</a>. Default set to <code>null</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#geoPoint">geoPoint</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps the field to a geo_point. Default: <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#alias">alias</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string value. The field noted with this parameter will be duplicated to an alias</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#dynamic">dynamic</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code>, <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only available for String properties. Determines whether this field should be dynamically mapped by elasticsearch.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="parentChild">4.3. Parent Child</h3>
<div class="paragraph">
<p>To map a parent/child relationship, the child element must either contain the parent element as a component or reference it as a referenced document.
This component must be mapped as a parent in the child element.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class ParentElement {
‚Ä¶
}

class EmbeddingChild {
    ParentElement parentElement

    static searchable = {
        parentElement parent: true, component: true
    }
}

class ReferencingChild {
    ParentElement parentElement

    static searchable = {
        parentElement parent: true, reference: true
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="geoPoint">4.4. Geo Point</h3>
<div class="paragraph">
<p>A geographic location can be mapped to a geo_point. The field for the longitude has to be named <code>lon</code> and the field for the latitude has to be named <code>lat</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class GeoPoint {

    Double lat
    Double lon

    static searchable = {
        root false
    }
}

class Building {

    String name
    GeoPoint location

    static searchable = {
        location geoPoint: true, component: true
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alias">4.5. Alias</h3>
<div class="paragraph">
<p>A field can be aliased.  This is useful in situations where another service may expect certain tags.</p>
</div>
<div class="paragraph">
<p>For example, <a href="http://www.elasticsearch.org/overview/kibana/">Kibana</a> uses an <code>\@timestamp</code> field to filter
report records by date.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Session {

    Date loginTime

    static searchable = {
        loginTime alias:'@timestamp'
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic">4.6. Dynamic</h3>
<div class="paragraph">
<p>Elasticsearch can map field contents as dynamic objects.</p>
</div>
<div class="paragraph">
<p>This is especially useful if you store JSON Strings in your database and want to make those objects searchable in elasticsearch.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Session {

    String jsonData

    static searchable = {
        dynamic: true
    }
}

Session session = new Session()
session.jsonData = ([foo: 'bar']¬†as JSON).toString()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default mapping would make the jsonData field an escaped String field and
a search for jsonData.foo = bar would result in no result.
With dynamic mapping enabled for this field, we enable JSON handling of this field and tell elasticsearch to map this field dynamically.
The result is that a search for <code>jsonData.foo=bar</code> would result in a search hit.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This will only work on String fields and will result in an error if the String is no valid json</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="searchableComponentReference">4.7. Searchable Component Reference</h3>
<div class="paragraph">
<p>The plugin support a similar searchable-component &amp; searchable-reference behaviour from Compass
when you are dealing with domain association.
See below to find out about the difference between both mapping modes.</p>
</div>
<div class="sect3">
<h4 id="searchableReference">4.7.1. Searchable Reference</h4>
<div class="paragraph">
<p>The searchable-reference mapping mode is the default mode used for association, and requires the
searchable class of the association to be root-mapped in order to have its own index.
With this mode, the associated domains are not completely marshalled in the resulting JSON document:
only the id and the type of the instances are kept.
When the document is retrieved from the index, the plugin will automatically rebuild the association from the
indices using the stored id.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class MyDomain {
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom

    static searchable = {
        odom reference:true
    }
}

// The OtherDomain definition, with default searchable configuration
class OtherDomain {
    static searchable = true

    String field1 = "val1"
    String field2 = "val2"
    String field3 = "val3"
    String field4 = "val4"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When indexing an instance of MyDomain, the resulting JSON documents will be sent to ElasticSearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
    "mydomain": {
        "_id":1,
        "odom": { "id":1 }
    }
}

{
    "otherdomain": {
        "_id":1,
        "field1":"val1",
        "field2":"val2",
        "field3":"val3",
        "field4":"val4"
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="searchableComponent">4.7.2. Searchable Component</h4>
<div class="paragraph">
<p>The searchable-component mapping mode must be explicitly set, and does not require the
searchable class of the association to be root-mapped.</p>
</div>
<div class="paragraph">
<p>With this mode, the associated domains are nested in the parent document.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class MyDomain {
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom

    static searchable = {
        odom component:true
    }
}

// The OtherDomain definition, with default searchable configuration
class OtherDomain {
    static searchable = true

    String field1 = "val1"
    String field2 = "val2"
    String field3 = "val3"
    String field4 = "val4"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When indexing an instance of MyDomain, the resulting JSON document will be sent to ElasticSearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-json" data-lang="json">{
    "mydomain": {
        "_id":1,
        "odom": {
            "_id":1,
            "field1":"val1",
            "field2":"val2",
            "field3":"val3",
            "field4":"val4"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;d rather that the reference object be mapped with type 'inner' rather than the default 'nested', set the 'component' key with a value of 'inner' rather than 'true':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class MyDomain {
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom

    static searchable = {
        odom component: 'inner'
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mappingMigrations">4.8. Mapping Migrations</h3>
<div class="paragraph">
<p>During the application startup the application will attempt to create the needed indices on Elasticsearch and create the type mappings defined by the user. If these indices and mappings already existed on the Elasticsearch cluster (ie. an older version of the application was running against it) and the new mapping definitions differ with the existing ones there&#8217;s the potential for a Mapping conflict. This section describes how to configure the application to deal with this scenario.</p>
</div>
<div class="paragraph">
<p>It is important to highlight that not all type mapping changes will result on a conflict. Ie. adding a new field to a mapping does not result in a conflict whilst changing a property from component:'inner' to nested or vice-versa, will. These strategies will only be needed and applied when a <strong>conflicting</strong> mapping is found.</p>
</div>
<div class="sect3">
<h4 id="migration-strategies">4.8.1. Migration Strategies</h4>
<div class="paragraph">
<p>The migration strategy is defined by the <code>elasticSearch.migration.strategy</code> configuration property and it accepts three values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>'none'</code></p>
</li>
<li>
<p><code>'deleteIndex'</code></p>
</li>
<li>
<p><span class="line-through"><code>'delete'</code> is no longer supported since the upgrade to Elasticsearch &gt; 2.0</span></p>
</li>
<li>
<p><code>'alias'</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default strategy is <code>'alias'</code> as it is the only strategy that can achieve zero-downtime migrations and thus <a href="http://www.elasticsearch.org/blog/changing-mapping-with-zero-downtime/">recommended by Elasticsearch</a></p>
</div>
<div class="paragraph">
<p>These values are described on more detail further ahead</p>
</div>
</div>
<div class="sect3">
<h4 id="migration-strategy-none">4.8.2. Migration Strategy 'none'</h4>
<div class="paragraph">
<p>This option keeps the original behaviour the plugin used before the Migration Strategies were implemented. When a Mapping Merge conflict id identified the event will be logged and an Exception will be logged.
It will be responsibility for the application administrator to manually fix the problem.</p>
</div>
<div class="paragraph">
<p>This configuration was left as a backwards compatibility and it will prevent the application from booting successfully, therefore we <strong>discourage teams from using this option</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="migration-strategy-deleteindex">4.8.3. Migration Strategy 'deleteIndex'</h4>
<div class="paragraph">
<p>When choosing this option, when a conflict occurs installing  mapping, the application will delete the existing index for the type, <strong>alongside with all content indexed on that index (including content from other mappings)</strong> and it will recreate the index and all its mappings. There are a couple of important details on this information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deleted documents can be automatically reindexed on startup by using the <code>elasticSearch.bulkIndexOnStartup</code> configuration property (See below)</p>
</li>
<li>
<p>New indices will be created with a version number and the right aliases, to make them compatible with potential future 'alias' migrations (without requiring additional index deletions)</p>
</li>
<li>
<p>Using this configuration there will always be a time window (between deletion and reindexation) where documents can&#8217;t be found by search, therefore this option cannot achieve a <strong>zero-downtime</strong> deployment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#dealing-with-deleted-content">Dealing with deleted content</a> below for more details on automatic indexing.</p>
</div>
</div>
<div class="sect3">
<h4 id="migration-strategy-alias">4.8.4. Migration Strategy 'alias'</h4>
<div class="paragraph">
<p>This is the migration strategy <a href="http://www.elasticsearch.org/blog/changing-mapping-with-zero-downtime/">recommended by Elasticsearch</a>.</p>
</div>
<div class="paragraph">
<p>To better understand this strategy we will describe a typical <code>'alias'</code> migration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Elasticsearch contains
  index 'myapplication.store_v27' with types 'car' and 'motorbike'
  alias 'myapplication.store' pointing to 'myapplication.store_v27'
  'myapplication.store_v27/car' contains 520 documents
  'myapplication.store_v27/motorbike' contains 12 documents
  index 'myapplication.admin_v0' with type 'quote'
  alias 'myapplication.admin' pointing to 'myapplication.admin_v0'
  'myapplication.admin_v0/quote' contains 3200 documents

The application is configured to use indexes based on package names 'myapplication.store' and 'myapplication.admin'
(which as we already explained are actually aliases that point to versioned indices)

The team introduced a change on the Car domain that results in a conflict on the 'car' mapping

The application starts up
    Tries to install the mapping for 'motorbike', it detects the conflict
    Creates a new index called 'myapplication.store_v28'
    Creates mappings 'myapplication.store_v28/car' and 'myapplication.store_v28/motorbike'
    Points all indexing requests for Car and Motorbike to the new index, while queries still happen on 'myapplication.store'
On Boostrap (bulkIndexOnStartup)
    It indexes 520 cars into 'myapplication.store_v28/car'
    It indexes 12 motorbikes into 'myapplication.store_v28/motorbike'
    Switches the 'myapplication.store' alias to point to 'myapplication.store_v28'
    Now all cars are indexed according to the new mapping
    Now all motorbikes are indexed according to the new mapping</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All content can be queried at all times, during Bootstrap bulkIndexOnStartup content will be retrieved from the old index.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even though there wasn&#8217;t a conflict on 'car', all cars needed to be reindexed as they lived on the same index.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are three potential scenarios when using the <code>'alias'</code> strategy:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scenario</th>
<th class="tableblock halign-left valign-top">Behaviour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index (ie. 'myapplication.store') does not exist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On this case there is not possibility of conflicts, as no previous mapping exist. However the application will behave slightly different than on the other to scenarios. Instead of creating the index (ie. 'myapplication.store'), it will create version 0 of it (ie. 'myapplication.store_v0') and an alias pointing to it. This is to facilitate the creation of future versions in case of conflict.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias exists pointing to a version (ie. 'myapplication.store' &#8594; 'myapplication.store_v27')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If there&#8217;s a conflict on a mapping on the index, it will create a new version (ie. 'myapplication.store_v28'), reindex the content or not depending on the value of the <code>elasticSearch.bulkIndexOnStartup</code> configuration property and point the alias to the new version once done.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index already exists (ie. 'myapplication.store')</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elasticsearch cannot rename an index or create an alias with the same name as an index. The two alternatives here are to delete the index or fail the migration. This is controlled by the <code>elasticSearch.migration.aliasReplacesIndex</code> configuration property, if set to true, it will delete the index and proceed the same way as when the index did not exist. The deleted documents will be reindexed or not depending on the value of the <code>elasticSearch.bulkIndexOnStartup</code>. <strong>This is the only scenario where there is content loss/downtime using the <code>'alias'</code> strategy.</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the case you wanted to create a new version of an index, but not change where the alias points to (ie. for testing or if you wanted to perform extra tasks on the index before updating the alias), the <code>elasticSearch.migration.disableAliasChange</code> configuration property can be used</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Aliases will only point to the new version of the index once all content is reindexed (if chosen to). Meanwhile, all index requests, either by <code>elasticSearchService</code> or using dynamic finders will go to the new version of the index, whilst queries will go to the old version of the index.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#dealing-with-deleted-content">Dealing with deleted content</a> below for more details on automatic indexing.</p>
</div>
</div>
<div class="sect3">
<h4 id="dealing-with-deleted-content">4.8.5. Dealing with deleted content</h4>
<div class="paragraph">
<p>Using the <code>'delete'</code> or <code>'alias'</code> strategy may lead to deleting content stored on Elasticsearch. This content can be automatically reindexed using the <code>elasticSearch.bulkIndexOnStartup</code>. The duration of this process will depend on the amount of content to index.</p>
</div>
<div class="paragraph">
<p>When this property is set to <code>true</code> all content will be deleted. When set to <code>'deleted'</code> only the domain classes which documents where deleted will be indexed. In either case, when using the <code>'alias'</code> strategy, once all content is indexed all aliases will point to the latest version of the index.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexing">5. Indexing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With its default configuration (with the <code>disableAutoIndex</code> configuration key set to <code>false</code>), the plugin is indexing
automatically any searchable domains when GORM/Hibernate do a save or an update in the database.</p>
</div>
<div class="paragraph">
<p>It also delete automatically from the index any document corresponding to a domain that is deleted from the database.
You normally shouldn&#8217;t have to worry about indexing, but sometimes you may have to do it by yourself, for example on dirty domain object that you may not want to save right now.</p>
</div>
<div class="paragraph">
<p>The plugin is providing a few injected methods in the domain or in the <code>ElasticSearchService</code> to allow that.</p>
</div>
<div class="sect2">
<h3 id="index-examples">5.1. Index examples</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// Index all searchable instances
elasticSearchService.index()

// Index a specific domain instance
MyDomain md = new MyDomain(value:'that')
md.save()
elasticSearchService.index(md)

// Index a collection of domain instances
def ds = [new MyDomain(value:'that'), new MyOtherDomain(name:'this'), new MyDomain(value:'thatagain')]
ds*.save()
elasticSearchService.index(ds)

// Index all instances of the specified domain class
elasticSearchService.index(MyDomain)
elasticSearchService.index(class:MyDomain)
elasticSearchService.index(MyDomain, MyOtherDomain)
elasticSearchService.index([MyDomain, MyOtherDomain])</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unindex-examples">5.2. Unindex examples</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// Unindex all searchable instances
elasticSearchService.unindex()

// Unindex a specific domain instance
MyDomain md = new MyDomain(value:'that')
md.save()
elasticSearchService.unindex(md)

// Unindex a collection of domain instances
def ds = [new MyDomain(value:'that'), new MyOtherDomain(name:'this'), new MyDomain(value:'thatagain')]
ds*.save()
elasticSearchService.unindex(ds)

// Unindex all instances of the specified domain class
elasticSearchService.unindex(MyDomain)
elasticSearchService.unindex(class:MyDomain)
elasticSearchService.unindex(MyDomain, MyOtherDomain)
elasticSearchService.unindex([MyDomain, MyOtherDomain])</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="searching">6. Searching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin provides 2 ways to send search requests.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can use the <code>elasticSearchService</code> and its public <code>search</code> method for cross-domain searching, meaning that ElasticSearch may analyze multiple indices and return hits of different types (=different domains).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def res = elasticSearchService.search("${params.query}")
// 'res' search results may contains multiple types of results</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can use the injected dynamic method in the domain for domain-specific searching.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def res = Tweet.search("${params.query}")
// 'res' search results contains only Tweet instances</code></pre>
</div>
</div>
<div class="paragraph">
<p>These search methods return a <code>Map</code> containing 3 entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>total</code> entry, representing the total number of hits found</p>
</li>
<li>
<p>a <code>searchResults</code> entry, containing the hits</p>
</li>
<li>
<p>a <code>scores</code> entry, containing the hits scores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def res = Tweet.search("${params.query}")
println "Found ${res.total} result(s)"
res.searchResults.each {
    println it.message
}

def res = elasticSearchService.search("${params.query}")
println "Found ${res.total} result(s)"
res.searchResults.each {
    if(it instanceof Tweet) {
        println it.message
    } else {
        println it.toString()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;re willing to retrieve only the number of hits for a peculiar query, you can use the <code>countHits()</code> method. It will only return an <code>Integer</code> representing the total hits matching your query.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def res = Tweet.countHits("${params.query}")
println "Found ${res} result(s)"

def res = elasticSearchService.countHits("${params.query}", [indices:'test'])
println "Found ${res} result(s)"</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="queryStrings">6.1. Query Strings</h3>
<div class="paragraph">
<p>The search method injected in the domain or the <code>ElasticSearchService</code> has multiple signatures available.
You can pass it a simple <code>String</code> to compute your search request. That string will be parsed by the <strong>Lucene query parser</strong> so feel free to use its syntax to do more specific search query.</p>
</div>
<div class="paragraph">
<p>You can find out about the syntax on the <a href="http://lucene.apache.org/java/3_0_3/queryparsersyntax.html">Apache Lucene website</a>.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def results = elasticSearchService.search("${params.query}")
def resultsTweets = Tweet.search("message:${params.query}")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queryClosure">6.2. Query Closure</h3>
<div class="paragraph">
<p>You can use the <a href="http://www.elasticsearch.org/guide/en/elasticsearch/client/groovy-api/current/search.html">Groovy Query DSL</a> to build your search query as a <code>Closure</code>.</p>
</div>
<div class="paragraph">
<p>The format of the search <code>Closure</code> follow the same JSON syntax as the  <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search.html">ElasticSearch REST API</a>
and the <a href="http://www.elasticsearch.org/guide/en/elasticsearch/client/java-api/current/query-dsl-queries.html">Java Query DSL</a>.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def result = elasticSearchService.search(searchType:'dfs_query_and_fetch') {
  bool {
      must {
          query_string(query: params.query)
      }
      if (params.firstname) {
          must {
              term(firstname: params.firstname)
          }
      }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queryBuilder">6.3. Query Builder</h3>
<div class="paragraph">
<p>A <code>QueryBuilder</code> can be passed to the search method.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">QueryBuilder query = QueryBuilders.matchAllQuery()
def result = elasticSearchService.search(query)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="filterClosure">6.4. Filter Closure</h3>
<div class="paragraph">
<p>A filter closure can be passed as a second argument after the search closure to the search method.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def result = elasticSearchService.search(
    [indices: Building, types: Building, sort: sortBuilder],
    null as Closure,
    {
        geo_distance(
            'distance': '5km',
            'location': [lat: 48.141, lon: 11.57]
        )
    })</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="filterBuilder">6.5. Filter Builder</h3>
<div class="paragraph">
<p>A <code>FilterBuilder</code> filter can be passed as a second argument after the search parameter to the search method.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">FilterBuilder filter = FilterBuilders.rangeFilter("price").gte(1.99).lte(2.3)
def result = elasticSearchService.search(
    [indices: Building, types: Building, sort: sortBuilder],
    null as Closure,
    filter)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="highlighting">6.6. Highlighting</h3>
<div class="paragraph">
<p>The search method support highlighting: automatic wrapping of the matching terms in the search results with
HTML/XML/Whatever tags.</p>
</div>
<div class="paragraph">
<p>You can activate this with a <code>Closure</code> containing the highlight settings in the search method <code>highlight</code> parameter.</p>
</div>
<div class="paragraph">
<p>The format of the <code>Closure</code> for defining the highlight settings is the same as the
<a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-request-highlighting.html">ElasticSearch REST API</a>.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// Define the pre &amp; post tag that will wrap each term matched in the document.
def highlighter = {
  field 'message'
  field 'tags.name'
  preTags '&lt;strong&gt;'
  postTags '&lt;/strong&gt;'
}

def results = Tweet.search("${params.query}", [highlight: highlightSettings])</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="highlightResults">6.6.1. Highlight results</h4>
<div class="paragraph">
<p>If a search result is found, the <code>search</code> method will add a <code>highlight</code> entry in the map result.</p>
</div>
<div class="paragraph">
<p>That entry contains a `List`with every highlighted fragments/fields found for each hit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def results = Tweet.search("${params.query}", [highlight: { field 'message' }])
def highlighted = results.highlight

results?.searchResults?.eachWithIndex { hit, index -&gt;
    // Retrieve the 'message' field fragments for the current hits
    def fragments = highlighted[index].message?.fragments

    // Print the fragment
    println fragments?.size() ? fragments[0] : ''
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="highlightedFields">6.6.2. Highlighted fields</h4>
<div class="paragraph">
<p>To determine which fields are to be processed by ElasticSearch, use the <code>field</code> setting.</p>
</div>
<div class="paragraph">
<p>You can call the <code>field</code> setting as many time as you want to add any field.</p>
</div>
<div class="paragraph">
<p><strong>Signature</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">field &lt;fieldName&gt;, &lt;fragmentSize&gt;, &lt;numberOfFragment&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def highlightSettings = {

    field 'message'                    // Add the 'message' field in the highlighted fields list

    field 'tags.name'                  // Add the 'name' field contained in the 'tags' field of
                                       // the document in the highlighted fields list

    field 'thatAwesomeField', 0, 20    // Add the 'thatAwesomeField' field with
                                       // some values fixed for fragmentSize and
 									   // numberOfFragment parameters
}

def highlightSettings2 = {
    field '_all'                       // Add the special '_all' field in the highlighted
 									   // fields list
}

def results = Tweet.search("${params.query}", [highlight: highlightSettings])
def results2 = Tweet.search("${params.query}", [highlight: highlightSettings2])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="highlightingTags">6.6.3. Highlighting tags</h4>
<div class="paragraph">
<p>By default, ElasticSearch will use emphasis tag &#8220;&lt;em&gt;&#8230;&#8203;&lt;/em&gt;&#8221; to wrap the matching text.</p>
</div>
<div class="paragraph">
<p>You can customize the tags with the <code>preTags</code> and <code>postTags</code> settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def highlightSettings = {
    field 'message'
    preTags '&lt;myAweSomeTag&gt;'
    postTags '&lt;/myAweSomeTag&gt;'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sorting">6.7. Sorting</h3>
<div class="paragraph">
<p>To sort the search results, either a field name or a SortBuilder must be passed.</p>
</div>
<div class="paragraph">
<p><strong>Returned sort values</strong></p>
</div>
<div class="paragraph">
<p>The sort values are not part of the search results themselves but are part of <code>result.sort</code>.</p>
</div>
<div class="paragraph">
<p><code>sort</code> contains all search values calculated by the ElasticSearch server as a list mapped to the id of the respective domain objects</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">assert [1:[23, 42], 2: [24, 40]] == result.sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in searching/sorting.adoc - include::sorting/geoDistanceSorting.adoc[]</p>
</div>
</div>
<div class="sect2">
<h3 id="pagination">6.8. Pagination</h3>
<div class="paragraph">
<p>To return paginated results one can pass <code>from</code> and <code>size</code> to search method query params.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">Post.search('xyz', [ indices: Post, types: Post, from: 0, size: 10 ] )

// or

elasticSearchService.search('xyz', [ indices: Post, types: Post, from: 0, size: 10 ])</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admin">7. Admin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin implements a few convenience methods for a few admin-oriented actions.</p>
</div>
<div class="sect2">
<h3 id="refresh">7.1. Refresh</h3>
<div class="paragraph">
<p>Explicitly refresh one or more index, making all operations performed since the last refresh available for search.
It will also flush the current IndexRequestQueue if there are pending index or delete requests from the application side.</p>
</div>
<div class="paragraph">
<p>The refresh method is not asynchronous, meaning that it will wait for all operations to complete before resuming the execution of your application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">elasticSearchService.index(domain)
// Some code...
// ...

elasticSearchService.index(domain2)
// Some code...
// ...

elasticSearchService.index(domain3)
// Some code...
// ...

elasticSearchAdminService.refresh() // Ensure that the 3 previous index
									// requests have been made searchable by ES</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deleteIndex">7.2. Delete Index</h3>
<div class="paragraph">
<p>Delete an index, all its mapping and its content from the ElasticSearch instance. Be careful when using this command because it cannot be undone.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated mapping from the grails plugin is also deleted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The method can be limited to one or more specific indices or applied to all indices at once (called with no parameter).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">elasticSearchAdminService.deleteIndex()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lowLevelAPI">8. Low Level API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you need to use the Elastic Search client directly, you can use the <code>elasticSearchHelper</code> bean that is injected in any services/controllers to get the current instance.</p>
</div>
<div class="paragraph">
<p>Simply encapsulate your code within a <code>withElasticSearch</code> bloc, and you will get a <code>org.elasticsearch.client.Client</code> implementation to play with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class MySearchService {
    static transactional = true

    def elasticSearchHelper

    def myMethod(indexName, settings) {
        elasticSearchHelper.withElasticSearch { client -&gt;
            // Do some stuff with the ElasticSearch client
            client.admin()
                .indices()
                .prepareCreate(indexName)
                .setSettings(settings)
                .execute()
                .actionGet()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refers to the <a href="http://www.elasticsearch.org/guide/reference/java-api/">Elastic Search API</a> for more information on the methods and properties available on the client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example">9. Example</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="twitter">9.1. Twitter</h3>
<div class="sect3">
<h4 id="theDomains">9.1.1. The Domains</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tweet {
  static searchable = {
    message boost:2.0
  }

  static belongsTo = [
          user:User
  ]

  static hasMany = [
          tags:Tag
  ]

  static constraints = {
    tags nullable:true, cascade:'save, update'
  }

  String message = ''
  Date dateCreated = new Date()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class User {
  static searchable = {
    except = 'password'
    lastname boost:20
    firstname boost:15, index:'not_analyzed'
    listOfThings index:'no'
    someThings index:'no'
    tweets component:true
  }

  static constraints = {
    tweets cascade:'all'
  }
  static hasMany = [
          tweets:Tweet
  ]
  static mappedBy = [
          tweets:'user'
  ]

  String lastname
  String firstname
  String password
  String activity = 'Evildoer'
  String someThings = 'something'
  ArrayList&lt;String&gt; listOfThings = ['this', 'that', 'andthis']
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tag {
  static searchable = {
    except=['boostValue']
  }

  String name
  Integer boostValue = 1
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="theController">9.1.2. The Controller</h4>
<div class="ulist">
<ul>
<li>
<p><strong>A action triggering indexation</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ElasticSearchController</code> (<code>testCaseService</code> is just dealing with GORM instructions):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class ElasticSearchController {
  def elasticSearchService
  def testCaseService

  def postTweet = {
    if(!params.user?.id) {
      flash.notice = "No user selected."
      redirect(action: 'index')
      return
    }
    User u = User.get(params.user.id)
    if (!u) {
      flash.notice = "User not found"
      redirect(action: 'index')
      return
    }
    // Create tweet
    testCaseService.addTweet(params.tweet?.message, u, params.tags)

    flash.notice = "Tweet posted"
    redirect(action: 'index')
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this code (considering that there are already <code>User</code> in the database), new Tweets will be indexed automatically,
and corresponding <code>User</code> indexed documents will be updated since we have set the <code>tweets</code> association as component.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for Tweets</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def searchForUserTweets = {
    def tweets = Tweet.search("${params.message.search}").searchResults
    def tweetsMsg = 'Messages : '
    tweets.each {
      tweetsMsg += "&lt;br /&gt;Tweet from ${it.user?.firstname} ${it.user?.lastname} : ${it.message} "
      tweetsMsg += "(tags : ${it.tags?.collect{t -&gt; t.name}})"
    }
    flash.notice = tweetsMsg
    redirect(action: 'index')
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for anything</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def searchAll = {
    def res = elasticSearchService.search("${params.query}").searchResults
    def resMsg = '&lt;strong&gt;Global search result(s):&lt;/strong&gt;&lt;br /&gt;'
    res.each {
      switch(it){
        case Tag:
          resMsg += "&lt;strong&gt;Tag&lt;/strong&gt; ${it.name}&lt;br /&gt;"
          break
        case Tweet:
          resMsg += "&lt;strong&gt;Tweet&lt;/strong&gt; \"${it.message}\" from ${it.user.firstname} ${it.user.lastname}&lt;br /&gt;"
          break
        case User:
          resMsg += "&lt;strong&gt;User&lt;/strong&gt; ${it.firstname} ${it.lastname}&lt;br /&gt;"
          break
        default:
          resMsg += "&lt;strong&gt;Other&lt;/strong&gt; ${it}&lt;br /&gt;"
          break
      }

    }
    flash.notice = resMsg
    redirect(action:'index')
 }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="geoDistanceSearch">9.2. Geo Distance Search</h3>
<div class="paragraph">
<p>A search for buildings with a geo_distance filter, ordered by distance.</p>
</div>
<div class="sect3">
<h4 id="geoDistanceDomains">9.2.1. Domains</h4>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class GeoPoint {

    Double lat
    Double lon

    static searchable = {
        root false
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>GeoPoint represents the geo coordinates for a building. The field names¬†<code>lat</code> and <code>lon</code> are mandatory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Building {

    String name
    GeoPoint location

    static searchable = {
        location geoPoint: true, component: true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The location of the building is mapped to an ElasticSearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.6/mapping-geo-point-type.html">geo_point</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="geoDistanceService">9.2.2. Service Methods</h4>
<div class="paragraph">
<p>Searching for all buildings sorted by distance with 5km radius around geo location (lat=41.141, lon=11.57)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def searchForBuildings() {
    Closure filter = {
        geo_distance(
            'distance': '5km',
            'location': [lat: 48.141, lon: 11.57]
        )
    }

    def sortBuilder = SortBuilders.geoDistanceSort("location").
        point(48.141, 11.57).
        unit(DistanceUnit.KILOMETERS).
        order(SortOrder.ASC)

    def result = elasticSearchService.search(
        [indices: Building, types: Building, sort: sortBuilder],
        null as Closure,
        filter)

    return [results: result.searchResults, distances: result.sort]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The calculated distances are not part of the search results themselves but are part of <code>result.sort</code>.
<code>sort</code> contains all search values calculated by the ElasticSearch server as a list mapped to the id of the respective domain objects</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">assert [1:[23, 42], 2: [24, 40]] == result.sort</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="parentChildExample">9.3. Parent/Child mapping</h3>
<div class="paragraph">
<p>A store with many departments</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Store {

    String name
    String description = "A description of a store"
    String owner = "Shopowner"

    static searchable = true

    static constraints = {
        name blank: false
        description nullable: true
        owner nullable: false
    }
}

class Department {

    String name
    Long numberOfProducts
    Store store

    static constraints = {
        numberOfProducts nullable: true
    }

    static searchable = {
        store parent: true, component:true
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Search for all departments which are childs of a store with the owner "Shopowner"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def result = elasticSearchService.search(
    QueryBuilders.hasParentQuery("store", QueryBuilders.matchQuery("owner", "Shopowner")),
    null as Closure,
    [indices: Department, types: Department]
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq">10. Frequently Asked Questions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="conflictingModules">10.1. Conflicting module versions</h3>
<div class="paragraph">
<p>Normally this issues happen where different versions of same modules are download from different plugins or dependencies in <code>build.gradle</code></p>
</div>
<div class="paragraph">
<p>It seems like there are multiple versions of groovy in the classpath. Looks similar to <a href="http://stackoverflow.com/questions/31099214/tomcat-conflicting-module-versions-module-groovy-all-is-loaded-in-version-2-3" class="bare">http://stackoverflow.com/questions/31099214/tomcat-conflicting-module-versions-module-groovy-all-is-loaded-in-version-2-3</a></p>
</div>
<div class="sect3">
<h4 id="exception">10.1.1. Exception</h4>
<div class="listingblock">
<div class="content">
<pre> log4j:ERROR Error initializing log4j: null
 java.lang.ExceptionInInitializerError
    at org.codehaus.groovy.runtime.InvokerHelper.&lt;clinit&gt;(InvokerHelper.java:61)
    at groovy.lang.GroovyObjectSupport.&lt;init&gt;(GroovyObjectSupport.java:32)
    at org.codehaus.groovy.grails.commons.AbstractGrailsApplication.&lt;init&gt;(
             AbstractGrailsApplication.java:45)
    at org.codehaus.groovy.grails.commons.DefaultGrailsApplication.&lt;init&gt;
            (DefaultGrailsApplication.java:95)
    at org.codehaus.groovy.grails.commons.DefaultGrailsApplication.&lt;init&gt;
            (DefaultGrailsApplication.java:91)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(
            NativeConstructorAccessorImpl.java:62)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(
        DelegatingConstructorAccessorImpl.java:45)
    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
    at java.lang.Class.newInstance(Class.java:442)


    at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:314)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
    at java.lang.Thread.run(Thread.java:745)
 **Caused by: groovy.lang.GroovyRuntimeException: Conflicting module versions. Module [groovy-all is  loaded in version 2.3.11 and you are trying to load version 2.4.4**</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="workaround">10.1.2. Workaround</h4>
<div class="listingblock">
<div class="content">
<pre>grails.project.dependency.resolution = {
    plugins {
        compile ":elasticsearch:0.0.4.5", { exclude "groovy-all" } // elasticsearch 1.6.0
    }
}</pre>
</div>
</div>
<div id="INFO" class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Above problem was reported with plugin version 0.0.4.5 and Grails 2.5.5.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.5.0.BUILD-SNAPSHOT<br>
Last updated 2018-10-02 06:32:55 +00:00
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>